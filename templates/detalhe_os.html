{% extends "base.html" %}
{% block title %}OS #{{ os.id }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-0">üßæ Ordem de Servi√ßo #{{ os.id }}</h3>
    <small class="text-muted">
      Aparelho: {{ os.aparelho.nome }} ({{ os.aparelho.marca }} / {{ os.aparelho.modelo }})
    </small>
  </div>
  <span class="badge bg-secondary fs-6">{{ os.status }}</span>
</div>

<div class="row g-4">

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">üìå Dados da OS</h5>

        <div class="mb-2">
          <strong>Cliente:</strong> {{ os.aparelho.cliente }}
        </div>

        <div class="mb-2">
          <strong>Prioridade:</strong>
          <span class="badge bg-info text-dark">{{ os.prioridade }}</span>
        </div>

        <div class="mb-2">
          <strong>Problema relatado:</strong>
          <div class="border rounded p-2 bg-light mt-1">{{ os.problema_relatado }}</div>
        </div>

        <hr>

        <div class="mb-2">
          <strong>T√©cnico designado:</strong>
          {% if os.funcionario %}
            {{ os.funcionario }}
          {% else %}
            <span class="text-muted">Ainda n√£o designado</span>
          {% endif %}
        </div>

        <div class="mb-2">
          <strong>Agendamento:</strong>
          {% if os.data_agendada and os.hora_agendada %}
            {{ os.data_agendada }} √†s {{ os.hora_agendada }}
          {% else %}
            <span class="text-muted">N√£o agendado</span>
          {% endif %}
        </div>

        <div class="mb-2">
          <strong>Criada em:</strong> {{ os.data_criacao }}
        </div>

        {% if os.data_conclusao %}
        <div class="mb-2">
          <strong>Conclu√≠da em:</strong> {{ os.data_conclusao }}
        </div>
        {% endif %}
      </div>
    </div>

    <div class="mt-3 d-flex gap-2 flex-wrap">
      {% if is_gestor %}
        <a class="btn btn-outline-primary" href="{% url 'designar_funcionario' os.id %}">
          üë®‚Äçüîß Designar t√©cnico
        </a>

        {% if os.status != "CONCLUIDO" %}
        <a class="btn btn-outline-danger" href="{% url 'finalizar_os' os.id %}">
          ‚úÖ Finalizar OS
        </a>
        {% endif %}
      {% endif %}

      {% if os.funcionario and funcionario and os.funcionario.id == funcionario.id %}
        <a class="btn btn-warning" href="{% url 'registrar_manutencao_os' os.id %}">
          üõ†Ô∏è Registrar manuten√ß√£o
        </a>
      {% endif %}

      <a class="btn btn-secondary" href="{% url 'home' %}">‚Ü©Ô∏è Voltar</a>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">üß∞ Hist√≥rico de Manuten√ß√µes</h5>

        {% if os.registros.all %}
          <div class="list-group">
            {% for r in os.registros.all %}
              <div class="list-group-item">
                <div class="d-flex justify-content-between">
                  <div>
                    <strong>{{ r.tipo_servico }}</strong>
                    {% if r.funcionario %}
                      <small class="text-muted"> ‚Äî {{ r.funcionario }}</small>
                    {% endif %}
                  </div>
                  <small class="text-muted">{{ r.data_execucao }}</small>
                </div>

                <div class="mt-2">
                  <strong>Descri√ß√£o:</strong>
                  <div class="border rounded p-2 bg-light mt-1">{{ r.descricao }}</div>
                </div>

                {% if r.peca_trocada %}
                <div class="mt-2">
                  <strong>Pe√ßa trocada:</strong> {{ r.peca_trocada }}
                </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">Ainda n√£o h√° registros de manuten√ß√£o nessa OS.</p>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
