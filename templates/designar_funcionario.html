{% extends "base.html" %}

{% block title %}Designar Funcionário{% endblock %}

{% block content %}
<div class="mx-auto max-w-2xl rounded-3xl border border-slate-200/70 bg-white/80 p-8 shadow-soft">
  <div class="mb-6">
    <p class="text-xs font-semibold uppercase tracking-[0.3em] text-sky-500">Gestao</p>
    <h2 class="mt-2 font-display text-2xl">Designar tecnico</h2>
    <p class="text-sm text-slate-500">
      OS #{{ ordem.id }} · {{ ordem.aparelho.nome }} ({{ ordem.aparelho.marca }} {{ ordem.aparelho.modelo }})
    </p>
  </div>

  <form method="post" class="space-y-5">
    {% csrf_token %}

    <div>
      <label class="form-label">Funcionario</label>
      <select name="funcionario" class="form-select" required>
        <option value="">Selecione...</option>
        {% for f in funcionarios %}
        <option value="{{ f.id }}">
          {{ f }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="grid gap-4 sm:grid-cols-2">
      <div>
        <label class="form-label">Data agendada</label>
        <input type="date" name="data_agendada" class="form-control">
      </div>
      <div>
        <label class="form-label">Hora agendada</label>
        <input type="time" name="hora_agendada" class="form-control">
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <a href="{% url 'home' %}" class="text-sm font-semibold text-slate-600 hover:text-slate-900">Voltar</a>
      <button type="submit" class="rounded-2xl bg-sky-500 px-5 py-3 text-sm font-semibold text-white transition hover:-translate-y-0.5">
        Salvar
      </button>
    </div>
  </form>
</div>

<div id="loading-overlay" class="fixed inset-0 z-[200] hidden items-center justify-center bg-slate-900/40 backdrop-blur-sm">
  <div class="rounded-3xl bg-white px-6 py-5 shadow-soft">
    <div class="flex items-center gap-3">
      <span class="h-4 w-4 animate-spin rounded-full border-2 border-slate-300 border-t-slate-900"></span>
      <p class="text-sm font-semibold text-slate-700">Carregando...</p>
    </div>
  </div>
</div>

<script>
  const form = document.querySelector("form");
  const overlay = document.getElementById("loading-overlay");

  form.addEventListener("submit", () => {
    overlay.classList.remove("hidden");
    overlay.classList.add("flex");
    form.querySelectorAll("button[type='submit'], a").forEach((el) => {
      el.setAttribute("disabled", "disabled");
      el.classList.add("pointer-events-none", "opacity-70");
    });
  });
</script>
{% endblock %}
